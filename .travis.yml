language: php

os:
    - linux

dist: xenial

services:
    - mysql

jobs:
    fast_finish: true
    include:
        # 1) previous MW LTS stable
        -   env: MW=REL1_31
            php: 7.2
        # 2) current MW LTS stable
#        -   env: MW=REL1_35
#            php: 7.4

env:
    NODE_RELEASE=8.x

before_install:
    # MW is not yet compatible with Composer 2.x, see https://phabricator.wikimedia.org/T266417
    - composer self-update --1
    - sudo rm -rf ~/.nvm
    - curl -sL "https://deb.nodesource.com/setup_${NODE_RELEASE}" | sudo -E bash -
    - sudo apt-get install -y nodejs

install:
    - bash ./build/travis/install-mediawiki.sh
    - npm install

script:
    - bash ./npm test test

cache:
    directories:
        - $HOME/.composer/cache
